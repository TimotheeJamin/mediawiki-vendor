{
    "2/ Extended annotation range": {
        "wt2wt": "This is <dummyanno>''an artificial'' '''example of'''</dummyanno> extension.",
        "selser [[0,0,0,0,[2],0,0]]": "This is ''an <dummyanno>artificial'' '''1qsg6e4example of'''</dummyanno> extension.",
        "selser [[0,0,0,3,0,0,0]]": "This is ''an <dummyanno>artificial'''''example</dummyanno> of''' extension.",
        "selser [2]": "1xytrta\n\nThis is ''an <dummyanno>artificial'' '''example</dummyanno> of''' extension.",
        "selser [1]": "This is ''an <dummyanno>artificial'' '''example</dummyanno> of''' extension.",
        "selser [[3,0,0,3,[3],0,0]]": "''an <dummyanno>artificial''</dummyanno> extension.",
        "selser [[3,0,0,0,[2],0,0]]": "''an <dummyanno>artificial'' '''1t0igeeexample of'''</dummyanno> extension.",
        "selser [[0,0,0,4,0,0,2]]": "This is ''an <dummyanno>artificial''1f1vdgi'''example</dummyanno> of'''13bdiw3 extension.",
        "selser [[3,0,0,2,[4],0,3]]": "''an <dummyanno>artificial''1c3h9a7 '''1jr9rm4'''</dummyanno>"
    },
    "8/ fostered annotation markers": {
        "wt2wt": "<dummyanno>\n{|\n|table\n|with\n|-\n\n|some\n|content\n\n|-\n|dummyanno\n|one line\n|}\n</dummyanno>"
    },
    "Annotation open tag in fosterable position should expand the range to the entire table": {
        "wt2wt": "<dummyanno>\n{|\n|table\n|with\n|-\n\n|some\n|content\n|-\n|dummyanno\n|one line\n|}\n</dummyanno>"
    },
    "Annotations should not be hoisted out of headers": {
        "html2html": "<h2 id=\"Organizational_and_Planning_Projects\" data-parsoid='{\"dsr\":[0,77,2,2,1,1]}'><meta typeof=\"mw:Annotation/dummyanno\" data-parsoid='{\"dsr\":[3,14,null,null]}' data-mw='{\"rangeId\":\"mwa0\",\"extendedRange\":false,\"wtOffsets\":[3,14]}'/><!--T:19--> Organizational and Planning Projects<meta typeof=\"mw:Annotation/dummyanno/End\" data-parsoid='{\"dsr\":[62,74,null,null]}' data-mw='{\"wtOffsets\":[62,74]}'/></h2>\n",
        "html2wt": "== <dummyanno><!--T:19--> Organizational and Planning Projects</dummyanno> ==\n"
    },
    "End dummyanno tag at the end of a paragraph and beginning within <i> should extend to the end of <i> but not the whole paragraph": {
        "wt2wt": "This should <dummyanno>''fail miserably'' ... let's fix it</dummyanno>",
        "selser [2]": "m7royv\n\nThis should ''fail <dummyanno>miserably'' ... let's fix it</dummyanno>",
        "selser [1]": "This should ''fail <dummyanno>miserably'' ... let's fix it</dummyanno>",
        "selser [[2,0,0,2,0]]": "11lfphnThis should ''fail <dummyanno>miserably''1ebnk1s ... let's fix it</dummyanno>",
        "selser [[4,0,0,0,0]]": "1kfpive''fail <dummyanno>miserably'' ... let's fix it</dummyanno>"
    },
    "Newlines should be inserted between annotation tags and pre": {
        "html2wt": "foo\n\n<dummyanno>\n bar\n</dummyanno>baz\nfoo\n bar\nbaz"
    },
    "Selser: add content at the end of a paragraph with badly nested content with annotation": {
        "selser [2]": "z0khzc\n\nSome ''stuff <dummyanno>and '''also some'' more</dummyanno> stuff''' than that.",
        "selser [[4,0,2,3,0,3]]": "18rh1vh<dummyanno>vh2hxg''stuff and '''also some''</dummyanno>",
        "selser [1]": "Some ''stuff <dummyanno>and '''also some'' more</dummyanno> stuff''' than that.",
        "selser [[3,0,0,0,0,0]]": "''stuff <dummyanno>and '''also some'' more</dummyanno> stuff''' than that.",
        "selser [[2,0,[0,2],0,0,0]]": "19zdddlSome <dummyanno>''stuff and 1and9od'''also some''<nowiki/>''' more stuff'''</dummyanno> than that.",
        "selser [[3,0,0,[4],0,3]]": "''stuff <dummyanno>and '''also some''<nowiki/>'''1h2xbjq'''</dummyanno>",
        "selser [[3,0,1,4,0,2]]": "<dummyanno>''stuff and '''also some''1fr9sqw</dummyanno>1vtroet than that.",
        "selser [[4,0,1,[3],0,4]]": "1otk6kv<dummyanno>''stuff and '''also some''</dummyanno>1pyrd7o",
        "selser [[2,0,1,2,0,4]]": "12yo0zcSome <dummyanno>''stuff and '''also some''1o1iabj''' more stuff'''</dummyanno>12nvpmj",
        "selser [[0,0,2,3,0,0]]": "Some <dummyanno>1tayar2''stuff and '''also some''</dummyanno> than that.",
        "selser [[3,0,[2,2],3,0,3]]": "<dummyanno>''1xeoko5stuff and 1yj6bmy'''also some''</dummyanno>"
    },
    "Selser: add content at the end of a paragraph with badly nested content without annotation": {
        "wt2wt": "Some ''stuff and '''also some'''''<nowiki/>''' more stuff''' than that.",
        "html2wt": "Some ''stuff and '''also some'''''<nowiki/>''' more stuff''' than that.",
        "selser [2]": "3qj52y\n\nSome ''stuff and '''also some'' more stuff''' than that.",
        "selser [[0,[2,0],[4],0]]": "Some ''1duaqbgstuff and '''also some''<nowiki/>'''wz27d''' than that.",
        "selser [1]": "Some ''stuff and '''also some'' more stuff''' than that.",
        "selser [[4,2,[2],0]]": "179mz1a1v8si9b''stuff and '''also some''<nowiki/>'''o4e5ew more stuff''' than that.",
        "selser [[4,1,1,2]]": "12ju0sf''stuff and '''also some''<nowiki/>''' more stuff'''fam1gc than that.",
        "selser [[3,[2,3],0,3]]": "''6ms8yxstuff and '' more stuff'''",
        "selser [[3,2,[4],0]]": "1hoa429''stuff and '''also some''<nowiki/>'''1j6m5bz''' than that.",
        "selser [[0,3,2,2]]": "Some 154o63d more stuff'''18kt1ix than that.",
        "selser [[0,3,0,0]]": "Some  more stuff''' than that.",
        "selser [[2,2,3,2]]": "q3t941Some fj1ax0''stuff and '''also some''10qo8iy than that.",
        "selser [[2,3,0,3]]": "48stf3Some  more stuff'''"
    },
    "Start dummyanno tag at the beginning of a paragraph and end within <i> should extend to the end of <i> but not the whole paragraph": {
        "wt2wt": "<dummyanno>This should ''fail miserably''</dummyanno> ... let's fix it",
        "selser [[0,0,2,0,0]]": "<dummyanno>This should 1z0qzb9''fail</dummyanno> miserably'' ... let's fix it",
        "selser [2]": "1wrg8qt\n\n<dummyanno>This should ''fail</dummyanno> miserably'' ... let's fix it",
        "selser [1]": "<dummyanno>This should ''fail</dummyanno> miserably'' ... let's fix it",
        "selser [[0,2,2,0,0]]": "<dummyanno>1srvhjdThis should 16hb3a''fail</dummyanno> miserably'' ... let's fix it",
        "selser [[0,3,0,0,4]]": "<dummyanno>''fail</dummyanno> miserably''c1ubd1",
        "selser [[0,4,2,0,3]]": "<dummyanno>15mb0x91eenui0''fail</dummyanno> miserably''"
    },
    "T296169: Extended annotations that yield a nested annotation should not nest said annotation": {
        "wt2wt": "a <dummyanno>''b'' c ''d  e f''</dummyanno> g",
        "selser [1]": "a ''<dummyanno>b'' c ''d </dummyanno> e <dummyanno>f</dummyanno>'' g",
        "selser [2]": "16fysu7\n\na ''<dummyanno>b'' c ''d </dummyanno> e <dummyanno>f</dummyanno>'' g",
        "selser [[0,0,0,4,0,0,0]]": "a ''<dummyanno>b''xlo8ml''d </dummyanno> e <dummyanno>f</dummyanno>'' g",
        "selser [[4,0,0,0,[4],0,0]]": "7m3mfk''<dummyanno>b'' c ''138rctg''</dummyanno> g"
    },
    "T296169: Nested annotations should be dropped in HTML output": {
        "wt2wt": "<dummyanno>t1</dummyanno> <dummyanno>t2</dummyanno> <dummyanno><ann2 name=\"plop\">t3</ann2></dummyanno>",
        "selser [2]": "1koe8pj\n\n<dummyanno><dummyanno>t1</dummyanno></dummyanno> <dummyanno>t2</dummyanno> <dummyanno><ann2 name=\"plop\">t3</ann2></dummyanno>"
    },
    "Two paragraphs between dummyanno tags should roundtrip without duplicating the tags (DSRs are adjusted correctly)": {
        "wt2wt": "<dummyanno>\nplop\n\nLet's have some text.\n</dummyanno>",
        "html2html": "<meta typeof=\"mw:Annotation/dummyanno\" data-parsoid='{\"dsr\":[0,11,null,null]}' data-mw='{\"rangeId\":\"mwa0\",\"extendedRange\":false,\"wtOffsets\":[0,11]}'/>\n<p data-parsoid='{\"dsr\":[12,16,0,0]}'>plop</p>\n\n<p data-parsoid='{\"dsr\":[18,39,0,0]}'>Let's have some text.</p>\n<meta typeof=\"mw:Annotation/dummyanno/End\" data-parsoid='{\"dsr\":[40,52,null,null]}' data-mw='{\"wtOffsets\":[40,52]}'/>",
        "html2wt": "<dummyanno>\nplop\n\nLet's have some text.\n</dummyanno>",
        "selser [0,[3],0,0,0]": "<dummyanno>\n\n\nLet's have some text.</dummyanno>",
        "selser [0,1,2,0,0]": "<dummyanno>plop\n\n1qqhx5l\n\nLet's have some text.</dummyanno>",
        "selser [0,0,4,4,0]": "<dummyanno>plop\n\n6ro820\n\n7i1bfi\n</dummyanno>",
        "selser [0,0,0,[2],0]": "<dummyanno>plop\n\np4u1vyLet's have some text.</dummyanno>",
        "selser [0,[4],0,0,0]": "<dummyanno>\n1yayklg\n\nLet's have some text.</dummyanno>",
        "selser [0,[2],3,1,0]": "<dummyanno>\n1h037qzplop\n\nLet's have some text.</dummyanno>",
        "selser [0,[4],4,[2],0]": "<dummyanno>\nlomlcw\n\n15fe00w\n\n10tpdidLet's have some text.</dummyanno>",
        "selser [0,4,0,0,0]": "<dummyanno>\n1zrter\n\nLet's have some text.</dummyanno>",
        "selser [0,4,3,1,0]": "<dummyanno>\nt9zvxt\n\nLet's have some text.</dummyanno>",
        "selser [0,1,0,0,0]": "<dummyanno>plop\n\nLet's have some text.</dummyanno>",
        "selser [0,1,0,[2],0]": "<dummyanno>plop\n\n19wl0n7Let's have some text.</dummyanno>",
        "selser [0,4,0,2,0]": "<dummyanno>\n13xtyfj\n\nlj67ed\n\nLet's have some text.</dummyanno>",
        "selser [0,3,4,0,0]": "<dummyanno>\nmom1vp\n\nLet's have some text.</dummyanno>"
    },
    "When metas are migrated out of p-tags, template continuity should not be broken": {
        "selser [0,0,0,0,1,2,0]": "{{1x|<div>a</div> b}}\n<dummyanno>\nc\n\n1j82v5d\n</dummyanno>",
        "selser [0,0,0,0,1,4,0]": "{{1x|<div>a</div> b}}\n<dummyanno>\nc\n\nlkbj4r\n</dummyanno>",
        "selser [0,0,0,0,1,3,0]": "{{1x|<div>a</div> b}}\n<dummyanno>\nc\n</dummyanno>",
        "selser [0,0,0,0,0,3,0]": "{{1x|<div>a</div> b}}\n<dummyanno>\nc\n</dummyanno>"
    },
    "dummyanno in the middle of fostered content should extend to the whole range, including fostered content": {
        "wt2wt": "<dummyanno>\nfoo\nbar\n{|\n|-\n|baz\n|}\n</dummyanno>",
        "selser [0,[2],1,0]": "<dummyanno>\nl787w5\nfoo\nbar\n{| data-foobar=\"1323k5f\"\n|-\n|baz\n\n|}\n</dummyanno>",
        "selser [0,3,[0,[[2,2]]],0]": "<dummyanno>\n{|\n|-\n|k7l2vo\n|1mv8odn\n|baz\n\n|}\n</dummyanno>",
        "selser [0,0,1,0]": "<dummyanno>\n\n{| data-foobar=\"1swbntt\"\n|-\n|baz\n\n|}\n</dummyanno>",
        "selser [0,0,[2,[[0,2]]],0]": "<dummyanno>\n\n{|<!--1lbmkl-->\n|-\n|ke1bvi\n|baz\n|}\n</dummyanno>",
        "selser [0,0,[4,1],0]": "<dummyanno>\n\n{|<!--i2dvx0-->\n|-\n|baz\n\n|}\n</dummyanno>",
        "selser [0,1,1,0]": "<dummyanno>\nfoo\nbar\n{| data-foobar=\"16ksxqa\"\n|-\n|baz\n\n|}\n</dummyanno>",
        "selser [0,0,2,0]": "<dummyanno>\n\n\n820rq9\n{|\n|-\n|baz\n\n|}\n</dummyanno>",
        "selser [0,2,[3,0],0]": "<dummyanno>\n12gr9uw\n\n\n{|\n|-\n|baz\n\n|}\n</dummyanno>",
        "selser [0,4,1,0]": "<dummyanno>\n1uuyu9q\n{| data-foobar=\"1epu667\"\n|-\n|baz\n\n|}\n</dummyanno>",
        "selser [0,4,[4,1],0]": "<dummyanno>\nk3pini\n{|<!--o3q0oe-->\n|-\n|baz\n\n|}\n</dummyanno>",
        "selser [0,[4],2,0]": "<dummyanno>\n1lfl0py\n\n1e3vmy4\n{|\n|-\n|baz\n\n|}\n</dummyanno>",
        "selser [0,1,[0,[2]],0]": "<dummyanno>\nfoo\nbar\n{|\n<!--i02ze8-->|-\n|baz\n\n|}\n</dummyanno>",
        "selser [0,4,[0,[2]],0]": "<dummyanno>\n1aa5gkn\n{|\n<!--1v27cn1-->|-\n|baz\n\n|}\n</dummyanno>",
        "selser [0,2,1,0]": "<dummyanno>\n1oorjzy\n\n\n{| data-foobar=\"1ybr6xf\"\n|-\n|baz\n\n|}\n</dummyanno>"
    }
}
